<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3260761044192529"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <title>Mindbet — My Account</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    body {
      background-color: #0d1117;
      color: #e6edf3;
      font-family: 'Segoe UI', sans-serif;
    }
    .tab-content .card {
      background-color: #161b22;
      border: none;
      box-shadow: 0 0 30px rgba(0,0,0,0.4);
      border-radius: 15px;
    }
    .card-body {
      padding: 2rem;
    }
    .nav-tabs .nav-link {
      background-color: transparent;
      border: none;
      color: #8b949e;
      transition: color 0.2s ease;
    }
    .nav-tabs .nav-link.active {
      color: #58a6ff;
      border-bottom: 2px solid #58a6ff;
    }
    .badge {
      font-size: 0.85rem;
    }
    .alert {
      background-color: #21262d;
      border: 1px solid #30363d;
      color: #e6edf3;
    }
    .btn-outline-light {
      border-color: #58a6ff;
      color: #58a6ff;
    }
    .btn-outline-light:hover {
      background-color: #58a6ff;
      color: #0d1117;
    }
    .list-group-item {
      background-color: #161b22;
      border-color: #30363d;
    }
  </style>
</head>
<body>

{% include "navbar.html" %}

<div class="container mt-5 mb-5">
  <h1 class="mb-4 fw-bold">👤 Welcome, {{ username }}
    {% if is_subscriber %}
      <span class="badge bg-success" style="box-shadow: 0 0 10px #2ea043;">💎 Premium</span>
    {% else %}
      <span class="badge bg-secondary">🆓 Free Plan</span>
    {% endif %}
  </h1>

  <ul class="nav nav-tabs mb-4" id="accountTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button">👤 Profile</button></li>
    <li class="nav-item"><button class="nav-link" id="subscription-tab" data-bs-toggle="tab" data-bs-target="#subscription" type="button">💳 Subscription</button></li>
    <li class="nav-item"><button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button">📈 Activity</button></li>
    <li class="nav-item"><button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button">⚙️ Settings</button></li>
  </ul>

  <div class="tab-content animate__animated animate__fadeIn" id="accountTabsContent">
    <!-- Profile -->
    <div class="tab-pane fade show active" id="profile">
      <div class="card mb-4">
        <div class="card-body">
          <h4 class="mb-3 text-info">👤 Profile Information</h4>
          <p><strong>Email:</strong> {{ email }}</p>
          <p><strong>Member Since:</strong> {{ member_since }}</p>
        </div>
      </div>
    </div>

    <!-- Subscription -->
    <div class="tab-pane fade" id="subscription">
      <div class="card mb-4">
        <div class="card-body">
          <h4 class="mb-3 text-warning">💳 Subscription Status</h4>
          {% if is_subscriber %}
            <div class="alert alert-success mb-3">
              💎 You are a <strong>Premium Subscriber</strong>. Enjoy unlimited simulations and early features.
            </div>
          {% else %}
            <div class="alert alert-warning mb-3">
              🆓 You're on the <strong>Free Plan</strong>. Simulations left today: <strong>{{ simulations_left }}</strong>/3
            </div>
            <form action="/create-checkout-session" method="POST">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-outline-light">Upgrade to Premium</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Activity -->
    <div class="tab-pane fade" id="activity">
      <div class="card mb-4">
        <div class="card-body">
          <h4 class="mb-3 text-success">📈 Recent Activity</h4>
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between">
              <span>Simulations Today:</span>
              <span>{{ 3 - simulations_left }}/3</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Plan:</span>
              <span>{% if is_subscriber %}Premium{% else %}Free{% endif %}</span>
            </li>
            <li class="list-group-item text-muted">More stats coming soon...</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Settings -->
<div class="tab-pane fade" id="settings">
  <div class="card mb-4">
    <div class="card-body">
      <h4 class="mb-3 text-secondary">⚙️ Account Settings</h4>

      {% if password_changed %}
        <div class="alert alert-success">✅ Password updated successfully!</div>
      {% elif password_error %}
        <div class="alert alert-danger">{{ password_error }}</div>
      {% endif %}

      <form method="POST" action="/account#settings">
        <div class="mb-3">
          <label for="current_password" class="form-label">Current Password</label>
          <input type="password" class="form-control" id="current_password" name="current_password" required>
        </div>
        <div class="mb-3">
          <label for="new_password" class="form-label">New Password</label>
          <input type="password" class="form-control" id="new_password" name="new_password" required>
        </div>
        <div class="mb-3">
          <label for="confirm_password" class="form-label">Confirm New Password</label>
          <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-outline-light">Update Password</button>
      </form>
    </div>
  </div>
</div>

  <a href="/" class="btn btn-outline-light mt-4">← Back to Simulation</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const hash = window.location.hash;
    if (hash) {
      const trigger = document.querySelector(`button[data-bs-target="${hash}"]`);
      if (trigger) new bootstrap.Tab(trigger).show();
    }
  });
</script>
</body>
</html>